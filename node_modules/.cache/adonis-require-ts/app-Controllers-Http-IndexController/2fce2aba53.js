"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const Database_1 = __importDefault(global[Symbol.for('ioc.use')]("Adonis/Lucid/Database"));
const User_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/User"));
class IndexController {
    async index({ auth, request, response, view }) {
        let general = {
            categorias: await Database_1.default.from('productos_categorias').select('categoria').distinct()
        };
        for (let i = 0; i < general.categorias.length; i++) {
            general.categorias[i].subcategoria = await Database_1.default.from('productos_categorias').select('subcategoria').where('categoria', general.categorias[i].categoria);
        }
        return view.render('index/home', { general });
    }
    async politicas_venta({ auth, request, response, view }) {
        let general = {
            categorias: await Database_1.default.from('productos_categorias').select('categoria').distinct()
        };
        for (let i = 0; i < general.categorias.length; i++) {
            general.categorias[i].subcategoria = await Database_1.default.from('productos_categorias').select('subcategoria').where('categoria', general.categorias[i].categoria);
        }
        return view.render('index/politicas_venta', { general });
    }
    async garantia_devolucion({ auth, request, response, view }) {
        let general = {
            categorias: await Database_1.default.from('productos_categorias').select('categoria').distinct()
        };
        for (let i = 0; i < general.categorias.length; i++) {
            general.categorias[i].subcategoria = await Database_1.default.from('productos_categorias').select('subcategoria').where('categoria', general.categorias[i].categoria);
        }
        return view.render('index/garantia_devolucion', { general });
    }
    async login_form({ auth, request, response, view }) {
        await auth.use('web').check();
        if (!auth.use('web').isLoggedIn) {
            return view.render('index/login');
        }
        else {
            response.redirect('/dashboard');
        }
    }
    async login_post({ auth, request, response, view }) {
        const username = request.input('username');
        const password = request.input('password');
        const user = await User_1.default
            .query()
            .where('username', username)
            .where('password', password)
            .first();
        if (user != null) {
            await auth.use('web').login(user);
        }
        response.redirect('/dashboard');
    }
    async dashboard({ auth, request, response, view }) {
        await auth.use('web').authenticate();
        let general = {};
        console.info(auth.user?.$attributes.username);
        return view.render('index/dashboard', { general });
    }
    async logout({ auth, request, response, view }) {
        await auth.use('web').logout();
        response.redirect('/login');
    }
}
exports.default = IndexController;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW5kZXhDb250cm9sbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiSW5kZXhDb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0EsMkZBQWlEO0FBQ2pELGlGQUFrQztBQUVsQyxNQUFxQixlQUFlO0lBRXpCLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBQyxJQUFJLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQXNCO1FBRW5FLElBQUksT0FBTyxHQUFHO1lBQ1YsVUFBVSxFQUFFLE1BQU0sa0JBQVEsQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsUUFBUSxFQUFFO1NBQ3pGLENBQUE7UUFDRCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDaEQsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxZQUFZLEdBQUcsTUFBTSxrQkFBUSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQyxLQUFLLENBQUMsV0FBVyxFQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUE7U0FDN0o7UUFFRCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFDLEVBQUMsT0FBTyxFQUFDLENBQUMsQ0FBQTtJQUM5QyxDQUFDO0lBR00sS0FBSyxDQUFDLGVBQWUsQ0FBQyxFQUFDLElBQUksRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBc0I7UUFFN0UsSUFBSSxPQUFPLEdBQUc7WUFDVixVQUFVLEVBQUUsTUFBTSxrQkFBUSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxRQUFRLEVB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TUFBTSxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLFlBQVksRUFBRSxDQUFBO1FBRXBDLElBQUksT0FBTyxHQUFHLEVBRWIsQ0FBQTtRQUNELE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUE7UUFDN0MsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixFQUFDLEVBQUMsT0FBTyxFQUFDLENBQUMsQ0FBQTtJQUNuRCxDQUFDO0lBRU0sS0FBSyxDQUFDLE1BQU0sQ0FBQyxFQUFDLElBQUksRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBc0I7UUFDcEUsTUFBTSxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFBO1FBQzlCLFFBQVEsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUE7SUFDL0IsQ0FBQztDQUNKO0FBbEZELGtDQWtGQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEh0dHBDb250ZXh0Q29udHJhY3QgfSBmcm9tICdAaW9jOkFkb25pcy9Db3JlL0h0dHBDb250ZXh0J1xyXG5pbXBvcnQgRGF0YWJhc2UgZnJvbSAnQGlvYzpBZG9uaXMvTHVjaWQvRGF0YWJhc2UnXHJcbmltcG9ydCBVc2VyIGZyb20gJ0FwcC9Nb2RlbHMvVXNlcidcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEluZGV4Q29udHJvbGxlciB7XHJcblxyXG4gICAgcHVibGljIGFzeW5jIGluZGV4KHthdXRoLCByZXF1ZXN0LCByZXNwb25zZSwgdmlld306IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcclxuXHJcbiAgICAgICAgbGV0IGdlbmVyYWwgPSB7XHJcbiAgICAgICAgICAgIGNhdGVnb3JpYXM6IGF3YWl0IERhdGFiYXNlLmZyb20oJ3Byb2R1Y3Rvc19jYXRlZ29yaWFzJykuc2VsZWN0KCdjYXRlZ29yaWEnKS5kaXN0aW5jdCgpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZ2VuZXJhbC5jYXRlZ29yaWFzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGdlbmVyYWwuY2F0ZWdvcmlhc1tpXS5zdWJjYXRlZ29yaWEgPSBhd2FpdCBEYXRhYmFzZS5mcm9tKCdwcm9kdWN0b3NfY2F0ZWdvcmlhcycpLnNlbGVjdCgnc3ViY2F0ZWdvcmlhJykud2hlcmUoJ2NhdGVnb3JpYScsZ2VuZXJhbC5jYXRlZ29yaWFzW2ldLmNhdGVnb3JpYSlcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB2aWV3LnJlbmRlcignaW5kZXgvaG9tZScse2dlbmVyYWx9KVxyXG4gICAgfVxyXG5cclxuICAgIC8vcG9saXRpY2FfdmVudGFcclxuICAgIHB1YmxpYyBhc3luYyBwb2xpdGljYXNfdmVudGEoe2F1dGgsIHJlcXVlc3QsIHJlc3BvbnNlLCB2aWV3fTogSHR0cENvbnRleHRDb250cmFjdCkge1xyXG5cclxuICAgICAgICBsZXQgZ2VuZXJhbCA9IHtcclxuICAgICAgICAgICAgY2F0ZWdvcmlhczogYXdhaXQgRGF0YWJhc2UuZnJvbSgncHJvZHVjdG9zX2NhdGVnb3JpYXMnKS5zZWxlY3QoJ2NhdGVnb3JpYScpLmRpc3RpbmN0KClcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBnZW5lcmFsLmNhdGVnb3JpYXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgZ2VuZXJhbC5jYXRlZ29yaWFzW2ldLnN1YmNhdGVnb3JpYSA9IGF3YWl0IERhdGFiYXNlLmZyb20oJ3Byb2R1Y3Rvc19jYXRlZ29yaWFzJykuc2VsZWN0KCdzdWJjYXRlZ29yaWEnKS53aGVyZSgnY2F0ZWdvcmlhJyxnZW5lcmFsLmNhdGVnb3JpYXNbaV0uY2F0ZWdvcmlhKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHZpZXcucmVuZGVyKCdpbmRleC9wb2xpdGljYXNfdmVudGEnLHtnZW5lcmFsfSlcclxuICAgIH1cclxuICAgIC8vZ2FyYW50aWFfZGV2b2x1Y2lvblxyXG4gICAgcHVibGljIGFzeW5jIGdhcmFudGlhX2Rldm9sdWNpb24oe2F1dGgsIHJlcXVlc3QsIHJlc3BvbnNlLCB2aWV3fTogSHR0cENvbnRleHRDb250cmFjdCkge1xyXG5cclxuICAgICAgICBsZXQgZ2VuZXJhbCA9IHtcclxuICAgICAgICAgICAgY2F0ZWdvcmlhczogYXdhaXQgRGF0YWJhc2UuZnJvbSgncHJvZHVjdG9zX2NhdGVnb3JpYXMnKS5zZWxlY3QoJ2NhdGVnb3JpYScpLmRpc3RpbmN0KClcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBnZW5lcmFsLmNhdGVnb3JpYXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgZ2VuZXJhbC5jYXRlZ29yaWFzW2ldLnN1YmNhdGVnb3JpYSA9IGF3YWl0IERhdGFiYXNlLmZyb20oJ3Byb2R1Y3Rvc19jYXRlZ29yaWFzJykuc2VsZWN0KCdzdWJjYXRlZ29yaWEnKS53aGVyZSgnY2F0ZWdvcmlhJyxnZW5lcmFsLmNhdGVnb3JpYXNbaV0uY2F0ZWdvcmlhKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHZpZXcucmVuZGVyKCdpbmRleC9nYXJhbnRpYV9kZXZvbHVjaW9uJyx7Z2VuZXJhbH0pXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGFzeW5jIGxvZ2luX2Zvcm0oe2F1dGgsIHJlcXVlc3QsIHJlc3BvbnNlLCB2aWV3fTogSHR0cENvbnRleHRDb250cmFjdCkge1xyXG4gICAgICAgIGF3YWl0IGF1dGgudXNlKCd3ZWInKS5jaGVjaygpXHJcbiAgICAgICAgaWYgKCFhdXRoLnVzZSgnd2ViJykuaXNMb2dnZWRJbikge1xyXG4gICAgICAgIHJldHVybiB2aWV3LnJlbmRlcignaW5kZXgvbG9naW4nKVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnJlZGlyZWN0KCcvZGFzaGJvYXJkJylcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhc3luYyBsb2dpbl9wb3N0KHthdXRoLCByZXF1ZXN0LCByZXNwb25zZSwgdmlld306IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcclxuICAgICAgICBjb25zdCB1c2VybmFtZSA9IHJlcXVlc3QuaW5wdXQoJ3VzZXJuYW1lJylcclxuICAgICAgICBjb25zdCBwYXNzd29yZCA9IHJlcXVlc3QuaW5wdXQoJ3Bhc3N3b3JkJyk7XHJcblxyXG4gICAgICAgIC8vIExvb2t1cCB1c2VyIG1hbnVhbGx5XHJcbiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXJcclxuICAgICAgICAgICAgLnF1ZXJ5KClcclxuICAgICAgICAgICAgLndoZXJlKCd1c2VybmFtZScsIHVzZXJuYW1lKVxyXG4gICAgICAgICAgICAud2hlcmUoJ3Bhc3N3b3JkJywgcGFzc3dvcmQpXHJcbiAgICAgICAgICAgIC5maXJzdCgpXHJcblxyXG4gICAgICAgIGlmICh1c2VyICE9IG51bGwpIHtcclxuICAgICAgICAgICAgLy8gQ3JlYXRlIHNlc3Npb25cclxuICAgICAgICAgICAgYXdhaXQgYXV0aC51c2UoJ3dlYicpLmxvZ2luKHVzZXIpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXNwb25zZS5yZWRpcmVjdCgnL2Rhc2hib2FyZCcpXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGFzeW5jIGRhc2hib2FyZCh7YXV0aCwgcmVxdWVzdCwgcmVzcG9uc2UsIHZpZXd9OiBIdHRwQ29udGV4dENvbnRyYWN0KSB7XHJcbiAgICAgICAgYXdhaXQgYXV0aC51c2UoJ3dlYicpLmF1dGhlbnRpY2F0ZSgpXHJcbiAgICAgICAgLy8g4pyFIFJlcXVlc3QgYXV0aGVudGljYXRlZFxyXG4gICAgICAgIGxldCBnZW5lcmFsID0ge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc29sZS5pbmZvKGF1dGgudXNlcj8uJGF0dHJpYnV0ZXMudXNlcm5hbWUpXHJcbiAgICAgICAgcmV0dXJuIHZpZXcucmVuZGVyKCdpbmRleC9kYXNoYm9hcmQnLHtnZW5lcmFsfSlcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYXN5bmMgbG9nb3V0KHthdXRoLCByZXF1ZXN0LCByZXNwb25zZSwgdmlld306IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcclxuICAgICAgICBhd2FpdCBhdXRoLnVzZSgnd2ViJykubG9nb3V0KClcclxuICAgICAgICByZXNwb25zZS5yZWRpcmVjdCgnL2xvZ2luJylcclxuICAgIH1cclxufVxyXG4iXX0=